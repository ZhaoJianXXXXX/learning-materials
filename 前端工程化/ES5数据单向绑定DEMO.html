<html>
	<head>
		<meta charset = "utf8"/>
		<title>data-binding</title>
	</head>
	<body>
		<div id = "mvvm">
			{{ name }}
		</div>
		<script type = 'text/javascript'>
			// 数据对象
			var data = {
				name : '',
			};
			// 操作函数
			function mvm (params) {
				// 缓存DOM字符
				var dom = document.getElementById('mvvm').innerHTML;
				// 循环设置data对象属性的set方法
				for(var pro in params){
					// 过滤原型链上的属性
					if(params.hasOwnProperty(pro)){
						// 定义监听赋值事件
						Object.defineProperty(params,pro,{
							set:function (v) {
								// 赋值
								this.value = v;
								// 匹配双大括号正则
								var regexp = new RegExp("\\{\\{\\s*" + pro + "\\s*\\}\\}","gi");
								// 替换
								htmlstr = dom.replace(regexp,this.value);
								// 渲染
								document.getElementById('mvvm').innerHTML = htmlstr;
							}
						});
					}
				}
			}
			// 启动
			mvm(data);
			// 赋值
			data.name = 'hehe';
			// 使用：请在控制台输入 data.name = '123'或者再增加js脚本执行data的改变;
		</script>
	</body>
</html>


//模板字符串渲染
<script type = 'text/javascript'>
	let templateStr = 'i am {{name}},age {{age}},job {{job}}, 在{{grow[0]}}和{{grow[1]}}, 家里有{{family.son}}和{{family.daughter}}和{{family.father[0]}}和{{family.father[1]}}';
	let data = {
		name:'xbd',
		age:18,
		job:'CTO',
		family: { son: '儿子', daughter: '女儿', father: ['生父', '继父'] },
		grow: ['北京', '天津']
	}
	// 字符串模板匹配
	String.prototype.templateRender = function(context) {
		let tokenReg = /(\\)?\{{([^\{\}\\]+)(\\)?\}}/g;
		return this.replace(tokenReg, function(word, slash1, token, slash2) {
			if (slash1 || slash2) {
				return word.replace('\\', '');
			}
			let variables = token.replace(/\s/g, '').split('.');
			let currentObject = context;
			let i, length;
			for (i = 0, length = variables.length; i < length; ++i) {
				let curVariables = variables[i].split('['); // 用`[`进行字符串分割 a[0][1] → ["a", "0]", "1]"]
				currentObject = currentObject[curVariables[0]]; // 第一位是数组名
				if (curVariables.length > 1) { // 如果大于1，则有`[`符号，就是数组对象
					curVariables.shift();  // 去掉数组名，循环["0]", "1]"]
					curVariables.forEach(function(item) {
						currentObject = currentObject[parseInt(item.substr(0, 1))]; // 用数组的索引取值
					});
				}
				if (currentObject === undefined || currentObject === null) return '';
			}
			return currentObject;
		});
	};
	templateStr.templateRender(data)
</script>
